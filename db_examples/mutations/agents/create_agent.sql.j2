-- Create Agent Mutation
-- Inserts a new agent into the agents table and optionally associates them with cultures
-- 
-- Parameters:
--   :name - Agent name (TEXT, required)
--   :age - Agent age (INT, must be > 1)
--   :memory_size - Memory capacity (INT, must be >= 3)
--   :culture_ids - Array of culture IDs to associate with the agent (INT[], optional)
--
-- Returns: The newly created agent's ID
--
-- Example usage:
--   INSERT INTO agents (name, age, memory_size) 
--   VALUES ('Athena', 25, 10);

-- Create the agent
INSERT INTO agents (name, age, memory_size) 
VALUES (:name, :age, :memory_size)
RETURNING id;

-- Associate agent with cultures if culture_ids are provided
{% if culture_ids %}
INSERT INTO agent_cultures (agent_id, culture_id)
SELECT 
    (SELECT id FROM agents WHERE name = :name ORDER BY id DESC LIMIT 1) as agent_id,
    unnest(:culture_ids) as culture_id;
{% endif %}
